<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—äº¬å¸‚å…»è€é‡‘ç»¼åˆæµ‹ç®—ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1); }
        .input-focus:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .result-card { transition: all 0.3s ease; }
        .result-card:hover { transform: translateY(-2px); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { border-bottom: 3px solid #667eea; color: #667eea; }
        .tooltip { position: relative; }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: #333;
            color: white;
            font-size: 12px;
            border-radius: 6px;
            white-space: nowrap;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-8">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-2">åŒ—äº¬å¸‚å…»è€é‡‘ç»¼åˆæµ‹ç®—ç³»ç»Ÿ</h1>
            <p class="text-center text-blue-100">ç¤¾ä¿åŸºæœ¬å…»è€ + ä¼ä¸šå¹´é‡‘ + ä¸ªäººå…»è€é‡‘ | ä¸‰æ”¯æŸ±å…¨é¢æµ‹ç®—</p >
        </div>
    </header>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- å·¦ä¾§ï¼šè¾“å…¥è¡¨å• -->
            <div class="space-y-6">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm mr-2">1</span>
                        åŸºæœ¬ä¿¡æ¯
                    </h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å‡ºç”Ÿæ—¥æœŸ</label>
                            <input type="date" id="birthDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" value="1973-10-04">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">é¢„è®¡é€€ä¼‘å¹´é¾„</label>
                            <select id="retireAge" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition">
                                <option value="60" selected>60å²</option>
                                <option value="61">61å²</option>
                                <option value="62">62å²</option>
                                <option value="63">63å²</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½“å‰æœˆè–ªï¼ˆç¨å‰ï¼‰</label>
                            <input type="number" id="currentSalary" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" placeholder="30000" value="40000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å·¥èµ„å¹´å¢é•¿ç‡</label>
                            <input type="number" id="salaryGrowth" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" placeholder="3" value="1" step="0.1">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                </div>
                <!-- ç¤¾ä¿ç¼´è´¹ä¿¡æ¯ -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm mr-2">2</span>
                        ç¤¾ä¿ç¼´è´¹ä¿¡æ¯
                    </h2>
                    
                    <!-- è§†åŒç¼´è´¹ -->
                    <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center mb-2">
                            <input type="checkbox" id="hasDeemed" class="w-4 h-4 text-blue-600 rounded" checked>
                            <label class="ml-2 text-sm font-medium text-gray-700">æœ‰è§†åŒç¼´è´¹å¹´é™ï¼ˆ1998å¹´å‰æœºå…³äº‹ä¸šå•ä½å·¥ä½œï¼‰</label>
                        </div>
                        <div id="deemedSection" class="grid md:grid-cols-2 gap-3 mt-2">
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">è§†åŒç¼´è´¹å¹´é™ï¼ˆå¹´ï¼‰</label>
                                <input type="number" id="deemedYears" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="4" step="0.5">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">è§†åŒç¼´è´¹æŒ‡æ•°</label>
                                <input type="number" id="deemedIndex" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="2.0" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 tooltip" data-tooltip="æŸ¥çœ‹ç¤¾ä¿å¯¹è´¦å•">å½“å‰ä¸ªäººè´¦æˆ·ä½™é¢</label>
                            <input type="number" id="currentBalance" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" placeholder="300000" value="487174">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å·²ç¼´è´¹å¹´é™</label>
                            <input type="number" id="paidYears" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" placeholder="20" value="21.67" step="0.01">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½“å‰ç¼´è´¹åŸºæ•°</label>
                            <input type="number" id="currentBase" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" placeholder="30000" value="35811">
                            <p class="text-xs text-gray-500 mt-1">2025å¹´åŒ—äº¬ä¸Šé™35,811å…ƒ</p >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç¼´è´¹æ¡£æ¬¡</label>
                            <select id="paymentLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition">
                                <option value="3.0" selected>300%ï¼ˆå°é¡¶ï¼‰</option>
                                <option value="2.0">200%</option>
                                <option value="1.0">100%ï¼ˆå¹³å‡ï¼‰</option>
                                <option value="0.6">60%ï¼ˆæœ€ä½ï¼‰</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- è¡¥å……å…»è€ -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm mr-2">3</span>
                        è¡¥å……å…»è€ä¿é™©ï¼ˆå¯é€‰ï¼‰
                    </h2>
                    
                    <!-- ä¼ä¸šå¹´é‡‘ -->
                    <div class="mb-4 p-4 bg-purple-50 rounded-lg">
                        <div class="flex items-center mb-2">
                            <input type="checkbox" id="hasEnterprise" class="w-4 h-4 text-purple-600 rounded" checked>
                            <label class="ml-2 text-sm font-medium text-gray-700">æœ‰ä¼ä¸šå¹´é‡‘</label>
                        </div>
                        <div id="enterpriseSection" class="grid md:grid-cols-2 gap-3 mt-2">
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">å½“å‰ä½™é¢</label>
                                <input type="number" id="enterpriseBalance" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="100000">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">å¹´ç¼´çº³é‡‘é¢</label>
                                <input type="number" id="enterpriseAnnual" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="100000">
                            </div>
                        </div>
                    </div>

                    <!-- ä¸ªäººå…»è€é‡‘ -->
                    <div class="p-4 bg-orange-50 rounded-lg">
                        <div class="flex items-center mb-2">
                            <input type="checkbox" id="hasPersonal" class="w-4 h-4 text-orange-600 rounded" checked>
                            <label class="ml-2 text-sm font-medium text-gray-700">æœ‰ä¸ªäººå…»è€é‡‘</label>
                        </div>
                        <div id="personalSection" class="grid md:grid-cols-2 gap-3 mt-2">
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">å½“å‰ä½™é¢</label>
                                <input type="number" id="personalBalance" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="51000">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">å¹´ç¼´çº³é‡‘é¢ï¼ˆæœ€é«˜1.2ä¸‡ï¼‰</label>
                                <input type="number" id="personalAnnual" class="w-full px-3 py-2 border border-gray-300 rounded text-sm" value="12000" max="12000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‚æ•°è®¾ç½® -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-gray-500 text-white rounded-full flex items-center justify-center text-sm mr-2">4</span>
                        æµ‹ç®—å‚æ•°
                    </h2>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç¤¾ä¿è®°è´¦åˆ©ç‡</label>
                            <input type="number" id="interestRate" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" value="2.5" step="0.1">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">è®¡å‘åŸºæ•°å¢é•¿ç‡</label>
                            <input type="number" id="baseGrowth" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" value="3" step="0.1">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç¼´è´¹åŸºæ•°å¢é•¿ç‡</label>
                            <input type="number" id="limitGrowth" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition" value="4" step="0.1">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-3">* 2024å¹´åŒ—äº¬å…»è€é‡‘è®¡å‘åŸºæ•°ä¸º11,883å…ƒ</p >
                </div>

                <button onclick="calculatePension()" class="w-full gradient-bg text-white font-bold py-4 rounded-xl text-lg hover:opacity-90 transition transform hover:scale-[1.02] active:scale-[0.98] shadow-lg">
                    å¼€å§‹æµ‹ç®—
                </button>
            </div>
            <!-- å³ä¾§ï¼šç»“æœå±•ç¤º -->
            <div class="space-y-6">
                <!-- æ€»è§ˆå¡ç‰‡ -->
                <div id="resultOverview" class="bg-white rounded-2xl p-6 card-shadow animate-fade-in" style="display:none;">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">æµ‹ç®—ç»“æœæ€»è§ˆ</h2>
                    
                    <div class="text-center mb-6">
                        <p class="text-gray-600 mb-2">é¢„è®¡æ¯æœˆå…»è€é‡‘</p >
                        <p class="text-5xl font-bold text-transparent bg-clip-text gradient-bg" id="totalMonthly">0</p >
                        <p class="text-gray-500 mt-1">å…ƒ/æœˆ</p >
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-xl text-center">
                            <p class="text-sm text-gray-600">å¹´åº¦å…»è€é‡‘</p >
                            <p class="text-2xl font-bold text-blue-600" id="totalYearly">0</p >
                            <p class="text-xs text-gray-500">å…ƒ/å¹´</p >
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl text-center">
                            <p class="text-sm text-gray-600">å…»è€é‡‘æ›¿ä»£ç‡</p >
                            <p class="text-2xl font-bold text-green-600" id="replacementRate">0%</p >
                            <p class="text-xs text-gray-500" id="replacementEval">è¯„ä»·</p >
                        </div>
                    </div>

                    <!-- å›¾è¡¨å®¹å™¨ -->
                    <div class="mb-6">
                        <canvas id="pensionChart" height="250"></canvas>
                    </div>
                    <!-- è¯¦ç»†åˆ†è§£ -->
                    <div class="space-y-3">
                        <h3 class="font-bold text-gray-800 mb-3">å…»è€é‡‘æ„æˆæ˜ç»†</h3>
                        
                        <div class="result-card bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-semibold text-gray-800">ç¤¾ä¿åŸºæœ¬å…»è€é‡‘</p >
                                    <p class="text-xs text-gray-600 mt-1">
                                        åŸºç¡€ <span id="basicPension">0</span> + 
                                        ä¸ªäººè´¦æˆ· <span id="personalPension">0</span> + 
                                        è¿‡æ¸¡æ€§ <span id="transPension">0</span>
                                    </p >
                                </div>
                                <p class="text-2xl font-bold text-blue-600" id="socialTotal">0</p >
                            </div>
                        </div>

                        <div class="result-card bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl" id="enterpriseCard" style="display:none;">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-semibold text-gray-800">ä¼ä¸šå¹´é‡‘</p >
                                    <p class="text-xs text-gray-600 mt-1">è´¦æˆ·ä½™é¢ <span id="enterpriseBalanceShow">0</span></p >
                                </div>
                                <p class="text-2xl font-bold text-purple-600" id="enterpriseMonthly">0</p >
                            </div>
                        </div>

                        <div class="result-card bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl" id="personalCard" style="display:none;">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-semibold text-gray-800">ä¸ªäººå…»è€é‡‘</p >
                                    <p class="text-xs text-gray-600 mt-1">ç¨åé¢†å–ï¼ˆ3%ç¨ç‡ï¼‰</p >
                                </div>
                                <p class="text-2xl font-bold text-orange-600" id="personalMonthly">0</p >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                <div id="detailTable" class="bg-white rounded-2xl p-6 card-shadow" style="display:none;">
                    <h3 class="font-bold text-gray-800 mb-4">é€€ä¼‘æ—¶è´¦æˆ·ç§¯ç´¯é¢„æµ‹</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left">è´¦æˆ·ç±»å‹</th>
                                    <th class="px-4 py-2 text-right">é¢„è®¡ä½™é¢</th>
                                    <th class="px-4 py-2 text-right">æœˆé¢†å–é¢</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="divide-y divide-gray-200">
                            </tbody>
                            <tfoot class="bg-gray-50 font-bold">
                                <tr>
                                    <td class="px-4 py-3">åˆè®¡</td>
                                    <td class="px-4 py-3 text-right" id="totalBalance">0</td>
                                    <td class="px-4 py-3 text-right" id="totalMonthlyTable">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <!-- å»ºè®® -->
                <div id="suggestions" class="bg-white rounded-2xl p-6 card-shadow" style="display:none;">
                    <h3 class="font-bold text-gray-800 mb-4">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h3>
                    <div id="suggestionContent" class="space-y-3 text-sm text-gray-700">
                    </div>
                </div>

                <!-- åˆå§‹æç¤º -->
                <div id="initialTip" class="bg-white rounded-2xl p-8 card-shadow text-center">
                    <div class="text-6xl mb-4">ğŸ“Š</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å¡«å†™å·¦ä¾§ä¿¡æ¯å¼€å§‹æµ‹ç®—</h3>
                    <p class="text-gray-600">è¾“å…¥æ‚¨çš„åŸºæœ¬ä¿¡æ¯ã€ç¤¾ä¿ç¼´è´¹æƒ…å†µå’Œè¡¥å……å…»è€ä¿¡æ¯ï¼Œè·å–ç²¾å‡†çš„å…»è€é‡‘é¢„æµ‹</p >
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;

        // ç›‘å¬checkboxå˜åŒ–
        document.getElementById('hasDeemed').addEventListener('change', function() {
            document.getElementById('deemedSection').style.display = this.checked ? 'grid' : 'none';
        });
        document.getElementById('hasEnterprise').addEventListener('change', function() {
            document.getElementById('enterpriseSection').style.display = this.checked ? 'grid' : 'none';
        });
        document.getElementById('hasPersonal').addEventListener('change', function() {
            document.getElementById('personalSection').style.display = this.checked ? 'grid' : 'none';
        });
        function calculatePension() {
            // è·å–è¾“å…¥å€¼
            const birthDate = new Date(document.getElementById('birthDate').value);
            const retireAge = parseInt(document.getElementById('retireAge').value);
            const currentSalary = parseFloat(document.getElementById('currentSalary').value) || 0;
            const salaryGrowth = parseFloat(document.getElementById('salaryGrowth').value) / 100 || 0;
            
            const hasDeemed = document.getElementById('hasDeemed').checked;
            const deemedYears = hasDeemed ? (parseFloat(document.getElementById('deemedYears').value) || 0) : 0;
            const deemedIndex = hasDeemed ? (parseFloat(document.getElementById('deemedIndex').value) || 1) : 0;
            
            const currentBalance = parseFloat(document.getElementById('currentBalance').value) || 0;
            const paidYears = parseFloat(document.getElementById('paidYears').value) || 0;
            const currentBase = parseFloat(document.getElementById('currentBase').value) || 0;
            const paymentLevel = parseFloat(document.getElementById('paymentLevel').value);
            
            const hasEnterprise = document.getElementById('hasEnterprise').checked;
            const enterpriseBalance = hasEnterprise ? (parseFloat(document.getElementById('enterpriseBalance').value) || 0) : 0;
            const enterpriseAnnual = hasEnterprise ? (parseFloat(document.getElementById('enterpriseAnnual').value) || 0) : 0;
            
            const hasPersonal = document.getElementById('hasPersonal').checked;
            const personalBalance = hasPersonal ? (parseFloat(document.getElementById('personalBalance').value) || 0) : 0;
            const personalAnnual = hasPersonal ? (parseFloat(document.getElementById('personalAnnual').value) || 0) : 0;
            
            const interestRate = parseFloat(document.getElementById('interestRate').value) / 100 || 0.025;
            const baseGrowth = parseFloat(document.getElementById('baseGrowth').value) / 100 || 0.03;
            const limitGrowth = parseFloat(document.getElementById('limitGrowth').value) / 100 || 0.04;

            // è®¡ç®—é€€ä¼‘å¹´ä»½
            const retireYear = birthDate.getFullYear() + retireAge;
            const currentYear = 2026;
            const yearsToRetire = retireYear - currentYear;
            
            // è®¡ç®—ç¼´è´¹å¹´é™
            const actualYears = paidYears + yearsToRetire;
            const totalYears = actualYears + deemedYears;
            
            // é¢„æµ‹é€€ä¼‘æ—¶è®¡å‘åŸºæ•°
            const base2024 = 11883;
            const yearsFrom2024 = retireYear - 2024;
            const pensionBase = base2024 * Math.pow(1 + baseGrowth, yearsFrom2024);
            // è®¡ç®—ç¤¾ä¿ä¸ªäººè´¦æˆ·ä½™é¢
            let accountBalance = currentBalance;
            let base = currentBase;
            
            for (let i = 0; i < yearsToRetire; i++) {
                const interest = accountBalance * interestRate;
                base = base * (1 + limitGrowth);
                const contribution = base * 12 * 0.08;
                accountBalance += interest + contribution;
            }
            
            if (retireYear === 2033) {
                const interest = accountBalance * interestRate * (10/12);
                const contribution = base * (1 + limitGrowth) * 0.08 * 10;
                accountBalance += interest + contribution;
            }
            
            // è®¡ç®—ä¼ä¸šå¹´é‡‘ä½™é¢
            let enterpriseFinal = enterpriseBalance;
            if (hasEnterprise) {
                for (let i = 0; i < yearsToRetire; i++) {
                    const rate = 0.04;
                    enterpriseFinal = enterpriseFinal * (1 + rate) + enterpriseAnnual;
                }
                if (retireYear === 2033) {
                    enterpriseFinal = enterpriseFinal * (1 + 0.04 * (10/12)) + enterpriseAnnual * (10/12);
                }
            }
            
            // è®¡ç®—ä¸ªäººå…»è€é‡‘ä½™é¢
            let personalFinal = personalBalance;
            if (hasPersonal) {
                for (let i = 0; i < yearsToRetire; i++) {
                    const rate = 0.03;
                    personalFinal = personalFinal * (1 + rate) + personalAnnual;
                }
                if (retireYear === 2033) {
                    personalFinal = personalFinal * (1 + 0.03 * (10/12)) + personalAnnual * (10/12);
                }
            }
            
            // è®¡ç®—å…»è€é‡‘
            const avgIndex = paymentLevel;
            const basicPension = pensionBase * (1 + avgIndex) / 2 * totalYears * 0.01;
            const months = retireAge === 60 ? 139 : (retireAge === 61 ? 132 : (retireAge === 62 ? 125 : 117));
            const personalPension = accountBalance / months;
            const transPension = hasDeemed ? pensionBase * deemedYears * deemedIndex * 0.01 : 0;
            const socialTotal = basicPension + personalPension + transPension;
            const enterpriseMonthly = hasEnterprise ? enterpriseFinal / months : 0;
            const personalMonthly = hasPersonal ? (personalFinal / months * 0.97) : 0;
            const totalMonthly = socialTotal + enterpriseMonthly + personalMonthly;
            // è®¡ç®—æ›¿ä»£ç‡
            const finalSalary = currentSalary * Math.pow(1 + salaryGrowth, yearsToRetire);
            const replacementRate = (totalMonthly / (finalSalary / 12)) * 100;

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('initialTip').style.display = 'none';
            document.getElementById('resultOverview').style.display = 'block';
            document.getElementById('detailTable').style.display = 'block';
            document.getElementById('suggestions').style.display = 'block';
            
            document.getElementById('totalMonthly').textContent = totalMonthly.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('totalYearly').textContent = (totalMonthly * 12 / 10000).toFixed(1) + 'ä¸‡';
            document.getElementById('replacementRate').textContent = replacementRate.toFixed(1) + '%';
            
            let evalText = '';
            if (replacementRate >= 70) evalText = 'ä¼˜ç§€ï¼è¶…è¿‡70%';
            else if (replacementRate >= 50) evalText = 'è‰¯å¥½ï¼50-70%';
            else if (replacementRate >= 40) evalText = 'ä¸­ç­‰ï¼40-50%';
            else evalText = 'åä½ï¼å»ºè®®è¡¥å……';
            document.getElementById('replacementEval').textContent = evalText;
            
            document.getElementById('basicPension').textContent = basicPension.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('personalPension').textContent = personalPension.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('transPension').textContent = transPension.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('socialTotal').textContent = socialTotal.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            
            if (hasEnterprise) {
                document.getElementById('enterpriseCard').style.display = 'block';
                document.getElementById('enterpriseBalanceShow').textContent = (enterpriseFinal / 10000).toFixed(1) + 'ä¸‡';
                document.getElementById('enterpriseMonthly').textContent = enterpriseMonthly.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            } else {
                document.getElementById('enterpriseCard').style.display = 'none';
            }
            
            if (hasPersonal) {
                document.getElementById('personalCard').style.display = 'block';
                document.getElementById('personalMonthly').textContent = personalMonthly.toLocaleString('zh-CN', {maximumFractionDigits: 0});
            } else {
                document.getElementById('personalCard').style.display = 'none';
            }
            // è¡¨æ ¼æ•°æ®
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            const rows = [
                ['ç¤¾ä¿åŸºæœ¬å…»è€ä¿é™©', accountBalance, socialTotal],
                hasEnterprise ? ['ä¼ä¸šå¹´é‡‘', enterpriseFinal, enterpriseMonthly] : null,
                hasPersonal ? ['ä¸ªäººå…»è€é‡‘', personalFinal, personalMonthly] : null
            ].filter(r => r !== null);
            
            rows.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-4 py-3">${row[0]}</td>
                    <td class="px-4 py-3 text-right">${row[1].toLocaleString('zh-CN', {maximumFractionDigits: 0})}å…ƒ</td>
                    <td class="px-4 py-3 text-right font-semibold">${row[2].toLocaleString('zh-CN', {maximumFractionDigits: 0})}å…ƒ</td>
                `;
                tableBody.appendChild(tr);
            });
            
            const totalBalance = accountBalance + enterpriseFinal + personalFinal;
            document.getElementById('totalBalance').textContent = (totalBalance / 10000).toFixed(1) + 'ä¸‡å…ƒ';
            document.getElementById('totalMonthlyTable').textContent = totalMonthly.toLocaleString('zh-CN', {maximumFractionDigits: 0}) + 'å…ƒ';
            
            // ç”Ÿæˆå»ºè®®
            generateSuggestions(replacementRate, hasEnterprise, hasPersonal, totalYears, retireAge);
            
            // ç»˜åˆ¶å›¾è¡¨
            drawChart(socialTotal, enterpriseMonthly, personalMonthly, hasEnterprise, hasPersonal);
            
            document.getElementById('resultOverview').scrollIntoView({ behavior: 'smooth' });
        }

        function generateSuggestions(rate, hasEnt, hasPer, years, age) {
            const container = document.getElementById('suggestionContent');
            container.innerHTML = '';
            const suggestions = [];
            
            if (rate < 50) suggestions.push('âš ï¸ æ‚¨çš„å…»è€é‡‘æ›¿ä»£ç‡åä½ï¼ˆ<50%ï¼‰ï¼Œå»ºè®®ï¼šâ‘ æé«˜ç¼´è´¹åŸºæ•° â‘¡å»¶é•¿ç¼´è´¹å¹´é™ â‘¢å¢åŠ ä¼ä¸šå¹´é‡‘æˆ–ä¸ªäººå…»è€é‡‘æŠ•å…¥');
            else if (rate >= 70) suggestions.push('âœ… æ‚¨çš„å…»è€é‡‘æ›¿ä»£ç‡ä¼˜ç§€ï¼ˆâ‰¥70%ï¼‰ï¼Œé€€ä¼‘ç”Ÿæ´»è´¨é‡æœ‰ä¿éšœï¼');
            else suggestions.push('âœ… æ‚¨çš„å…»è€é‡‘æ›¿ä»£ç‡è‰¯å¥½ï¼ˆ50-70%ï¼‰ï¼Œç¬¦åˆå›½é™…å»ºè®®æ°´å¹³ã€‚');
            
            if (!hasEnt) suggestions.push('ğŸ’¡ æ‚¨ç›®å‰æ²¡æœ‰ä¼ä¸šå¹´é‡‘ï¼Œå»ºè®®å’¨è¯¢å•ä½æ˜¯å¦èƒ½å»ºç«‹ä¼ä¸šå¹´é‡‘è®¡åˆ’ï¼Œæˆ–è€ƒè™‘å•†ä¸šå…»è€ä¿é™©è¡¥å……ã€‚');
            else suggestions.push('âœ… æ‚¨æœ‰ä¼ä¸šå¹´é‡‘ï¼Œè¿™æ˜¯å¾ˆå¥½çš„è¡¥å……å…»è€ä¿éšœã€‚å»ºè®®æŒç»­ç¼´è´¹è‡³é€€ä¼‘ã€‚');
            
            if (!hasPer) suggestions.push('ğŸ’¡ å»ºè®®å¼€é€šä¸ªäººå…»è€é‡‘è´¦æˆ·ï¼Œæ¯å¹´æœ€é«˜ç¼´çº³1.2ä¸‡å…ƒï¼Œå¯äº«å—ç¨æ”¶ä¼˜æƒ ï¼ˆæ¯å¹´èŠ‚ç¨360-5400å…ƒï¼‰ã€‚');
            else suggestions.push('âœ… æ‚¨å·²å‚ä¸ä¸ªäººå…»è€é‡‘ï¼Œå»ºè®®æ¯å¹´é¡¶æ ¼ç¼´çº³1.2ä¸‡å…ƒï¼Œæœ€å¤§åŒ–ç¨æ”¶ä¼˜æƒ ã€‚');
            
            if (years < 15) suggestions.push('âš ï¸ æ‚¨çš„ç´¯è®¡ç¼´è´¹å¹´é™ä¸è¶³15å¹´ï¼Œéœ€ç»§ç»­ç¼´è´¹è‡³æ»¡15å¹´æ‰èƒ½é¢†å–å…»è€é‡‘ã€‚');
            else if (years < 30) suggestions.push('ğŸ’¡ æ‚¨çš„ç¼´è´¹å¹´é™' + years.toFixed(1) + 'å¹´ï¼Œå·²è¶…è¿‡æœ€ä½è¦æ±‚ï¼Œä½†ç»§ç»­ç¼´è´¹å¯æ˜¾è‘—æé«˜å…»è€é‡‘ï¼ˆæ¯å¤šç¼´1å¹´çº¦å¢åŠ 3%ï¼‰ã€‚');
            else suggestions.push('âœ… æ‚¨çš„ç¼´è´¹å¹´é™é•¿è¾¾' + years.toFixed(1) + 'å¹´ï¼Œå……åˆ†ä½“ç°"é•¿ç¼´å¤šå¾—"ï¼');
            
            if (age < 62) suggestions.push('ğŸ’¡ å¦‚èº«ä½“å¥åº·å…è®¸ï¼Œå¯è€ƒè™‘å»¶è¿Ÿé€€ä¼‘è‡³62å²ï¼Œå…»è€é‡‘å¯æé«˜çº¦20-25%ã€‚');
            
            suggestions.forEach(s => {
                const p = document.createElement('p');
                p.className = 'p-3 bg-gray-50 rounded-lg';
                p.textContent = s;
                container.appendChild(p);
            });
        }

        function drawChart(social, enterprise, personal, hasEnt, hasPer) {
            const ctx = document.getElementById('pensionChart').getContext('2d');
            if (myChart) myChart.destroy();
            
            const labels = ['ç¤¾ä¿åŸºæœ¬å…»è€'];
            const data = [social];
            const colors = ['#3B82F6'];
            
            if (hasEnt) { labels.push('ä¼ä¸šå¹´é‡‘'); data.push(enterprise); colors.push('#A855F7'); }
            if (hasPer) { labels.push('ä¸ªäººå…»è€é‡‘'); data.push(personal); colors.push('#F97316'); }
            
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: labels, datasets: [{ data: data, backgroundColor: colors, borderWidth: 2, borderColor: '#fff' }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 15, font: { size: 11 } } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return label + ': ' + value.toFixed(0) + 'å…ƒ (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
